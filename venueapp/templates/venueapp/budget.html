{% extends "venueapp/base.html" %}

{% load bt crispy_forms_tags bootstrap %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <h3 class="text-center">{{ object }} Budget{{ object.venues.count|pluralize }}</h3>
    {% include "venueapp/pieces/addremove_venues.html" %}
    <p class="mt-3 text-center">
      Please provide a separate budget for each venue you are applying to.
    </p>
  </div>
</div>

<div class="row justify-content-center">
  <form method="POST" class="col">
    {% csrf_token %}
    {{ form.management_form }}
    <ul class="nav nav-tabs" role="tablist">
      {% for form in form %}
      {% ifchanged form.instance.venue %}
      <li class="nav-item">
	<a class="nav-link {% if forloop.first %}active{% endif %}"
	   data-toggle="tab" href="#budget-tab-{{ form.instance.venue.id }}">
	  {{ form.instance.venue.venue }}
	</a>
      </li>
      {% endifchanged %}
      {% endfor %}
    </ul>
    <div class="tab-content">
      {% for form in form %}
      {% ifchanged form.instance.venue %}
      {% if forloop.first %}
      <div class="tab-pane fade show active" role="tabpanel"
	   id="budget-tab-{{ form.instance.venue.id }}">
	{% else %}
      </div>
      <div class="tab-pane fade" role="tabpanel"
	   id="budget-tab-{{ form.instance.venue.id }}">
	{% endif %}
	{% endifchanged %}
	{% ifchanged form.instance.category %}
	<h5>{{ form.instance.get_category_display }}</h5>
	{% endifchanged %}
	<div class="budget-line">
	  <div class="row">
	    {{ form.id }}
	    <div class="col-md-4 col-sm-4">
	      {{ form.name|as_crispy_field }}
	    </div>
	    <div class="col-md-2 col-sm-3 dollar-field">
	      {{ form.amount|as_crispy_field }}
	    </div>
	    <div class="col-md-5 col-sm-3">
	      {{ form.notes|as_crispy_field }}
	    </div>
	    {% if not form.instance.required %}
	    <div class="col-md-1 col-sm-2 mt-3">
	      <button type="button"
		      class="btn btn-sm btn-danger mt-4 remove-line">
		<i class="fa fa-minus-square"></i>
	      </button>
	    </div>
	    {% endif %}
	  </div>
	  {% if not form.instance.required %}
	  <div class="text-center deletion-message">
	    You must save changes to confirm deletion of this budget line.
	  </div>
	  <div class="d-none">
	    {{ form.DELETE|as_crispy_field }}
	  </div>
	  {% endif %}
	  {% if form.non_field_errors %}
	  <div class="alert alert-danger">{{ form.non_field_errors }}</div>
	  {% endif %}
	</div>
	{% endfor %}
      </div>
    </div>
    <button type="submit" class="btn btn-primary btn-block">
      Save Changes
    </button>
  </form>
</div>

<form method="POST" action="{% url 'venueapp:add_staff' object.pk %}">
  {% csrf_token %}
  <div class="row justify-content-center mt-5">
    <div class="col-md-4 col-sm-6">
      {{ add_form.role }}
    </div>
    <div class="col-md-3 col-sm-8 mt-3">
      <div class="form-group mt-1">
	<button type="submit" class="btn btn-secondary mt-3 form-control">
	  Invite Staff Member
	</button>
      </div>
    </div>
  </div>
</form>
{% endblock %}
