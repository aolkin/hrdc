{% extends "venueapp/base.html" %}

{% load bt %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <h3 class="text-center">Venue Application Manager</h3>
    {% if live.exists %}
    <p class="text-center my-4">
      <a href="{% url 'venueapp:new' %}" class="btn btn-success btn-lg">
	Start a New Application
      </a>
    </p>
    {% else %}
    <p class="text-center my-4">
      No new applications are currently available to start, check back later.
    </p>
    {% endif %}
  </div>
</div>

{% if roles.exists %}
<h3 class="text-center">Your Application{{ roles.count|pluralize }}</h3>
<table class="table table-responsive bt-table-responsive table-striped">
  <thead>
    <tr>
      <th class="table-col-md">Show</th>
      <th class="table-col-md">Venue(s)</th>
      <th class="table-col-md">Role</th>
      <th class="text-center">Status</th>
      <th class="text-center">Pre App</th>
      <th class="text-center">Full App</th>
    </tr>
  </thead>
  <tbody>
    {% for role in roles %}
    {% with show=role.show.show meta=role.show %}
    <tr>
      <td>{{ show.title }}</td>
      <td>{{ show.seasonstr }} &ndash; {{ meta.venuestr }}</td>
      <td>
	{% if role.signed_on %}
	<a href="{% url 'venueapp:individual' meta.pk role.pk %}">
	  {% endif %}
	  {{ role.role }}
	  {% if role.signed_on %}
	</a>
	{% endif %}
      </td>
      <td class="text-center" {% if not role.all_status %}title="Your portion of the application is missing components"{% endif %}>
	{% if role.signed_on %}
	{% include "venueapp/pieces/checkmark.html" with value=role.all_status only %}
	{% else %}
	<a href="{% url 'venueapp:join' meta.pk role.pk %}"
	   class="btn btn-success">Sign On</a>
	{% endif %}
      </td>
      <td class="text-center" title="{{ meta.pre_submitted|default:'' }}">
	{% include "venueapp/pieces/checkmark.html" with value=meta.pre_submitted %}
	{% if not meta.pre_submitted %}
	<div><small>Due {{ meta.prelim_due|date:"M j g:i A" }}</small></div>
	{% endif %}
      </td>
      <td class="text-center" title="{{ meta.full_submitted|default:'' }}">
	{% include "venueapp/pieces/checkmark.html" with value=meta.full_submitted %}
	{% if not meta.full_submitted %}
	<div><small>Due {{ meta.full_due|date:"M j g:i A" }}</small></div>
	{% endif %}
      </td>
    </tr>
    {% endwith %}
    {% endfor %}
</table>
{% else %}
<p class="lead mx-5 mt-3">
  You do not have any applications in this system. If you have been invited to
  join an application but do not see it here, check who you are logged in as
  and make sure you were added with the correct email address.
</p>
{% endif %}

{% endblock %}
